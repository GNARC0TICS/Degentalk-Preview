/**
 * Tipping Analytics Controller
 *
 * Handles requests for tipping analytics data in the admin dashboard
 */

import type { Request, Response } from 'express';
import { tippingAnalyticsService } from './tipping-analytics.service';
import { logger } from '@core/logger';
import { sendSuccessResponse, sendErrorResponse } from '@core/utils/transformer.helpers';

class TippingAnalyticsController {
	/**
	 * Get tipping analytics data
	 * GET /api/admin/analytics/engagement/tips
	 */
	async getTippingAnalytics(req: Request, res: Response) {
		try {
			// Extract query parameters with defaults
			const days = req.query.days ? parseInt(req.query.days as string) : 30;
			const topLimit = req.query.topLimit ? parseInt(req.query.topLimit as string) : 10;

			// Validate parameters
			if (isNaN(days) || days < 1 || days > 365) {
				return sendErrorResponse(res, 'Invalid days parameter. Must be between 1 and 365.', 400);
			}

			if (isNaN(topLimit) || topLimit < 1 || topLimit > 100) {
				return sendErrorResponse(res, 'Invalid topLimit parameter. Must be between 1 and 100.', 400);
			}

			// Get analytics data from service
			const analytics = await tippingAnalyticsService.getTippingAnalytics(days, topLimit);

			// Return the data
			return sendSuccessResponse(res, analytics);
		} catch (error) {
			logger.error('Error fetching tipping analytics:', error);
			return sendErrorResponse(res, 'An error occurred while fetching tipping analytics', 500);
		}
	}
}

export const tippingAnalyticsController = new TippingAnalyticsController();
