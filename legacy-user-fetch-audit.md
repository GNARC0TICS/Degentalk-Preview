| File                                                                                          | Line | Category   | Code                                                                                                           |
| --------------------------------------------------------------------------------------------- | ---- | ---------- | -------------------------------------------------------------------------------------------------------------- |
| server/src/core/base-controller.ts:194                                                        | 194  | controller | protected getUserId(req: any): number {                                                                        |
| server/src/core/base-controller.ts:195                                                        | 195  | controller | const userId = req.user?.id;                                                                                   |
| server/src/core/base-controller.ts:206                                                        | 206  | controller | const role = req.user?.role;                                                                                   |
| server/src/core/rate-limiter.ts:21                                                            | 21   | other      | const key = req.ip \|\| req.user?.id?.toString() \|\| 'anonymous';                                             |
| server/src/middleware/auth.ts:18                                                              | 18   | middleware | if (req.user?.role !== 'admin') {                                                                              |
| server/src/middleware/auth.ts:30                                                              | 30   | middleware | return req.user?.role === 'admin';                                                                             |
| server/src/middleware/auth.ts:42                                                              | 42   | middleware | if (req.user?.role !== 'moderator' && req.user?.role !== 'admin') {                                            |
| server/src/middleware/authenticate.ts:59                                                      | 59   | middleware | req.user = {                                                                                                   |
| server/src/middleware/dev-security.middleware.ts:98                                           | 98   | middleware | if (!req.user) {                                                                                               |
| server/src/middleware/mission-progress.ts:20                                                  | 20   | middleware | const userId = req.user?.id;                                                                                   |
| server/src/middleware/subscription-permissions.ts:32                                          | 32   | middleware | const userId = req.user?.id;                                                                                   |
| server/src/middleware/subscription-permissions.ts:131                                         | 131  | middleware | const userId = req.user?.id;                                                                                   |
| server/src/utils/auth.ts:6                                                                    | 6    | other      | \* Prefers `req.user.id`, falls back to `req.user.user_id`.                                                    |
| server/src/utils/auth.ts:15                                                                   | 15   | other      | if (req.user) {                                                                                                |
| server/src/utils/auth.ts:16                                                                   | 16   | other      | const user = req.user as any; // Cast to any to access potential id properties                                 |
| server/src/utils/auth.ts:29                                                                   | 29   | other      | logger.warn('AuthUtil', 'User ID accessed via fallback req.user.user_id', {                                    |
| server/src/utils/auth.ts:35                                                                   | 35   | other      | logger.error('AuthUtil', 'User ID not found or not a number in req.user', {                                    |
| server/src/utils/auth.ts:36                                                                   | 36   | other      | userObject: req.user                                                                                           |
| server/src/core/middleware/security.middleware.ts:257                                         | 257  | middleware | userId: (req.user as any)?.id,                                                                                 |
| server/src/core/middleware/security.middleware.ts:268                                         | 268  | middleware | userId: (req.user as any)?.id,                                                                                 |
| server/src/core/audit/audit-logger.ts:497                                                     | 497  | other      | const user = req.user;                                                                                         |
| server/src/core/utils/error-response.util.ts:113                                              | 113  | other      | userId: (req.user as any)?.id,                                                                                 |
| server/src/core/services/rate-limit.service.ts:70                                             | 70   | service    | const userId = (req.user as any)?.id;                                                                          |
| server/src/core/services/user.service.ts:45                                                   | 45   | service    | getUserFromRequest(req: any): AuthenticatedUser \| null {                                                      |
| server/src/core/services/user.service.ts:46                                                   | 46   | service    | const user = req.user;                                                                                         |
| server/src/core/services/user.service.ts:247                                                  | 247  | service    | const user = this.getUserFromRequest(req);                                                                     |
| server/src/core/services/user.service.ts:307                                                  | 307  | service    | export function getUserFromRequest(req: any): AuthenticatedUser \| null {                                      |
| server/src/core/services/user.service.ts:308                                                  | 308  | service    | return userService.getUserFromRequest(req);                                                                    |
| server/src/domains/auth/auth.routes.ts:125                                                    | 125  | routes     | const user = await storage.getUser(id);                                                                        |
| server/src/domains/advertising/user-promotion.routes.ts:51                                    | 51   | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/advertising/user-promotion.routes.ts:79                                    | 79   | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/advertising/user-promotion.routes.ts:138                                   | 138  | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/advertising/user-promotion.routes.ts:171                                   | 171  | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/advertising/user-promotion.routes.ts:263                                   | 263  | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/advertising/user-promotion.routes.ts:392                                   | 392  | routes     | const moderatorId = userService.getUserFromRequest(req)?.id;                                                   |
| server/src/domains/admin/admin.controller.ts:66                                               | 66   | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/admin.middleware.ts:19                                               | 19   | middleware | export function getUserId(req: Request): number {                                                              |
| server/src/domains/admin/admin.middleware.ts:21                                               | 21   | middleware | return (userService.getUserFromRequest(req) as any)?.id \|\| 0;                                                |
| server/src/domains/admin/admin.middleware.ts:75                                               | 75   | middleware | const user = userService.getUserFromRequest(req) as any;                                                       |
| server/src/domains/admin/admin.middleware.ts:136                                              | 136  | middleware | const user = userService.getUserFromRequest(req) as any;                                                       |
| server/src/domains/dictionary/dictionary.routes.ts:57                                         | 57   | routes     | authorId: userService.getUserFromRequest(req).id                                                               |
| server/src/domains/dictionary/dictionary.routes.ts:77                                         | 77   | routes     | userService.getUserFromRequest(req).id                                                                         |
| server/src/domains/dictionary/dictionary.routes.ts:91                                         | 91   | routes     | userService.getUserFromRequest(req).id                                                                         |
| server/src/domains/feature-gates/feature-gates.controller.ts:49                               | 49   | controller | // @ts-ignore - req.user is added by auth middleware                                                           |
| server/src/domains/feature-gates/feature-gates.controller.ts:50                               | 50   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/feature-gates/feature-gates.controller.ts:78                               | 78   | controller | // @ts-ignore - req.user is added by auth middleware                                                           |
| server/src/domains/feature-gates/feature-gates.controller.ts:79                               | 79   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/gamification/achievement.controller.ts:155                                 | 155  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/gamification/achievement.controller.ts:238                                 | 238  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/gamification/admin.controller.ts:405                                       | 405  | controller | adminId: userService.getUserFromRequest(req)?.id                                                               |
| server/src/domains/forum/forum.controller.ts:32                                               | 32   | controller | userService.getUserFromRequest(req) &&                                                                         |
| server/src/domains/forum/forum.controller.ts:33                                               | 33   | controller | (userService.getUserFromRequest(req) as any).role === 'admin';                                                 |
| server/src/domains/missions/missions.controller.ts:27                                         | 27   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/missions/missions.controller.ts:29                                         | 29   | controller | const userLevel = userService.getUserFromRequest(req)?.level \|\| 1;                                           |
| server/src/domains/missions/missions.controller.ts:49                                         | 49   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/missions/missions.controller.ts:138                                        | 138  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/paths/paths.routes.ts:62                                                   | 62   | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/paths/paths.routes.ts:78                                                   | 78   | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/paths/paths.routes.ts:102                                                  | 102  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/preferences/preferences.routes.ts:86                                       | 86   | routes     | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/preferences/preferences.routes.ts:108                                      | 108  | routes     | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/preferences/preferences.routes.ts:132                                      | 132  | routes     | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/preferences/preferences.routes.ts:156                                      | 156  | routes     | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/preferences/preferences.routes.ts:180                                      | 180  | routes     | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/preferences/preferences.routes.ts:204                                      | 204  | routes     | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/preferences/preferences.routes.ts:226                                      | 226  | routes     | user: userService.getUserFromRequest(req),                                                                     |
| server/src/domains/preferences/preferences.routes.ts:367                                      | 367  | routes     | const username = (userService.getUserFromRequest(req) as any).username;                                        |
| server/src/domains/notifications/notification.routes.ts:32                                    | 32   | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/notifications/notification.routes.ts:58                                    | 58   | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/notifications/notification.routes.ts:80                                    | 80   | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/notifications/notification.routes.ts:107                                   | 107  | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/gamification/mission.controller.ts:225                                     | 225  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/gamification/mission.controller.ts:255                                     | 255  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/profile/profile-stats.controller.ts:36                                     | 36   | controller | if (userService.getUserFromRequest(req)?.id) {                                                                 |
| server/src/domains/profile/profile-stats.controller.ts:37                                     | 37   | controller | await ProfileStatsService.updateLastSeen(userService.getUserFromRequest(req).id);                              |
| server/src/domains/profile/profile-stats.controller.ts:52                                     | 52   | controller | userService.getUserFromRequest(req)?.id === stats.id                                                           |
| server/src/domains/profile/profile-stats.controller.ts:77                                     | 77   | controller | viewerId: userService.getUserFromRequest(req)?.id \|\| null,                                                   |
| server/src/domains/profile/profile.routes.ts:173                                              | 173  | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/profile/profile.routes.ts:193                                              | 193  | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/profile/profile.routes.ts:213                                              | 213  | routes     | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/profile/social-actions.controller.ts:32                                    | 32   | controller | if (!userService.getUserFromRequest(req)?.id) {                                                                |
| server/src/domains/profile/social-actions.controller.ts:42                                    | 42   | controller | userService.getUserFromRequest(req).id,                                                                        |
| server/src/domains/profile/social-actions.controller.ts:68                                    | 68   | controller | if (!userService.getUserFromRequest(req)?.id) {                                                                |
| server/src/domains/profile/social-actions.controller.ts:78                                    | 78   | controller | userService.getUserFromRequest(req).id,                                                                        |
| server/src/domains/profile/social-actions.controller.ts:105                                   | 105  | controller | if (!userService.getUserFromRequest(req)?.id) {                                                                |
| server/src/domains/profile/social-actions.controller.ts:115                                   | 115  | controller | userService.getUserFromRequest(req).id,                                                                        |
| server/src/domains/profile/social-actions.controller.ts:141                                   | 141  | controller | if (!userService.getUserFromRequest(req)?.id) {                                                                |
| server/src/domains/profile/social-actions.controller.ts:151                                   | 151  | controller | userService.getUserFromRequest(req).id,                                                                        |
| server/src/domains/profile/social-actions.controller.ts:171                                   | 171  | controller | if (!userService.getUserFromRequest(req)?.id) {                                                                |
| server/src/domains/profile/social-actions.controller.ts:185                                   | 185  | controller | userService.getUserFromRequest(req).id                                                                         |
| server/src/domains/profile/social-actions.controller.ts:207                                   | 207  | controller | if (!userService.getUserFromRequest(req)?.id) {                                                                |
| server/src/domains/profile/social-actions.controller.ts:215                                   | 215  | controller | const pendingRequests = await this.getPendingRequests(userService.getUserFromRequest(req).id);                 |
| server/src/domains/gamification/leveling.controller.ts:160                                    | 160  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:109                                   | 109  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:135                                   | 135  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:162                                   | 162  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:194                                   | 194  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:219                                   | 219  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:267                                   | 267  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:370                                   | 370  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:414                                   | 414  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:496                                   | 496  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:586                                   | 586  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:646                                   | 646  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/enhanced-shoutbox.routes.ts:669                                   | 669  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/shoutbox.routes.ts:95                                             | 95   | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/shoutbox.routes.ts:96                                             | 96   | routes     | const isAdminOrMod = userService.getUserFromRequest(req)                                                       |
| server/src/domains/shoutbox/shoutbox.routes.ts:99                                             | 99   | routes     | id: (userService.getUserFromRequest(req) as any).id,                                                           |
| server/src/domains/shoutbox/shoutbox.routes.ts:100                                            | 100  | routes     | primaryRoleId: (userService.getUserFromRequest(req) as any).primaryRoleId,                                     |
| server/src/domains/shoutbox/shoutbox.routes.ts:101                                            | 101  | routes     | secondaryRoleIds: (userService.getUserFromRequest(req) as any).secondaryRoleIds                                |
| server/src/domains/shoutbox/shoutbox.routes.ts:230                                            | 230  | routes     | const moderatorId = userService.getUserFromRequest(req);                                                       |
| server/src/domains/shoutbox/shoutbox.routes.ts:279                                            | 279  | routes     | const currentUserId = userService.getUserFromRequest(req);                                                     |
| server/src/domains/shoutbox/shoutbox.routes.ts:433                                            | 433  | routes     | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/shoutbox/shoutbox.routes.ts:544                                            | 544  | routes     | const userIdForLog = userService.getUserFromRequest(req); // Ensure userId is available                        |
| server/src/domains/shoutbox/shoutbox.routes.ts:594                                            | 594  | routes     | const moderatorId = userService.getUserFromRequest(req);                                                       |
| server/src/domains/shop/shop.routes.ts:129                                                    | 129  | routes     | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/shop/shop.routes.ts:133                                                    | 133  | routes     | const userId = (userService.getUserFromRequest(req) as { id: number }).id;                                     |
| server/src/domains/shop/shop.routes.ts:240                                                    | 240  | routes     | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/shop/shop.routes.ts:249                                                    | 249  | routes     | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/shop/shop.routes.ts:253                                                    | 253  | routes     | const userId = (userService.getUserFromRequest(req) as { id: number }).id;                                     |
| server/src/domains/shop/shop.routes.ts:277                                                    | 277  | routes     | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/social/follows.routes.ts:68                                                | 68   | routes     | const followerId = userService.getUserFromRequest(req)!.id;                                                    |
| server/src/domains/social/follows.routes.ts:94                                                | 94   | routes     | const followerId = userService.getUserFromRequest(req)!.id;                                                    |
| server/src/domains/social/follows.routes.ts:116                                               | 116  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/follows.routes.ts:141                                               | 141  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/follows.routes.ts:165                                               | 165  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/follows.routes.ts:182                                               | 182  | routes     | const followerId = userService.getUserFromRequest(req)!.id;                                                    |
| server/src/domains/social/follows.routes.ts:199                                               | 199  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/follows.routes.ts:263                                               | 263  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/follows.routes.ts:281                                               | 281  | routes     | const currentUserId = userService.getUserFromRequest(req)!.id;                                                 |
| server/src/domains/social/follows.routes.ts:298                                               | 298  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/follows.routes.ts:315                                               | 315  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/follows.routes.ts:333                                               | 333  | routes     | const followerId = userService.getUserFromRequest(req)!.id;                                                    |
| server/src/domains/social/friends.routes.ts:64                                                | 64   | routes     | const requesterId = userService.getUserFromRequest(req)!.id;                                                   |
| server/src/domains/social/friends.routes.ts:116                                               | 116  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:138                                               | 138  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:162                                               | 162  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:178                                               | 178  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:194                                               | 194  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:211                                               | 211  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:229                                               | 229  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:247                                               | 247  | routes     | const currentUserId = userService.getUserFromRequest(req)!.id;                                                 |
| server/src/domains/social/friends.routes.ts:264                                               | 264  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:281                                               | 281  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:299                                               | 299  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/friends.routes.ts:322                                               | 322  | routes     | const senderId = userService.getUserFromRequest(req)!.id;                                                      |
| server/src/domains/social/mentions.routes.ts:42                                               | 42   | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/mentions.routes.ts:68                                               | 68   | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/mentions.routes.ts:85                                               | 85   | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/mentions.routes.ts:102                                              | 102  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/mentions.routes.ts:119                                              | 119  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/social/whale-watch.routes.ts:36                                            | 36   | routes     | const followerId = userService.getUserFromRequest(req)!.id;                                                    |
| server/src/domains/social/whale-watch.routes.ts:70                                            | 70   | routes     | const followerId = userService.getUserFromRequest(req)!.id;                                                    |
| server/src/domains/social/whale-watch.routes.ts:169                                           | 169  | routes     | const currentUserId = userService.getUserFromRequest(req)!.id;                                                 |
| server/src/domains/social/whale-watch.routes.ts:203                                           | 203  | routes     | const currentUserId = userService.getUserFromRequest(req)!.id;                                                 |
| server/src/domains/treasury/treasury.routes.ts:46                                             | 46   | routes     | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/treasury/treasury.routes.ts:365                                            | 365  | routes     | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/treasury/treasury.routes.ts:512                                            | 512  | routes     | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/subscriptions/subscription.controller.ts:20                                | 20   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/subscriptions/subscription.controller.ts:65                                | 65   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/subscriptions/subscription.controller.ts:99                                | 99   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/subscriptions/subscription.controller.ts:134                               | 134  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/subscriptions/subscription.controller.ts:183                               | 183  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/subscriptions/subscription.controller.ts:219                               | 219  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/subscriptions/subscription.controller.ts:315                               | 315  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/subscriptions/subscription.controller.ts:316                               | 316  | controller | const userRole = userService.getUserFromRequest(req)?.role;                                                    |
| server/src/domains/user/user-preferences.routes.ts:44                                         | 44   | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/user/user-preferences.routes.ts:62                                         | 62   | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/user/user-preferences.routes.ts:93                                         | 93   | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/user/user-preferences.routes.ts:111                                        | 111  | routes     | const userId = userService.getUserFromRequest(req)!.id;                                                        |
| server/src/domains/uploads/upload.controller.ts:16                                            | 16   | controller | // So, `req.user` should be available and typed correctly if `requireAuth` middleware is used.                 |
| server/src/domains/uploads/upload.controller.ts:18                                            | 18   | controller | // The `req.user` type comes from the global Express namespace augmentation in `authenticate.ts`.              |
| server/src/domains/uploads/upload.controller.ts:34                                            | 34   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/uploads/upload.controller.ts:78                                            | 78   | controller | // Relies on global Express.User augmentation from authenticate.ts for req.user typing                         |
| server/src/domains/uploads/upload.controller.ts:93                                            | 93   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/treasury.controller.ts:220                                          | 220  | controller | const adminId = (userService.getUserFromRequest(req) as { id: number }).id;                                    |
| server/src/domains/wallet/treasury.controller.ts:281                                          | 281  | controller | const adminId = (userService.getUserFromRequest(req) as { id: number }).id;                                    |
| server/src/domains/wallet/wallet.routes.ts:31                                                 | 31   | routes     | const userId = req.body.userId \|\| userService.getUserFromRequest(req)?.id;                                   |
| server/src/domains/wallet/wallet.routes.ts:58                                                 | 58   | routes     | const userId = (req.query.userId as string) \|\| userService.getUserFromRequest(req)?.id;                      |
| server/src/domains/wallet/wallet.routes.ts:85                                                 | 85   | routes     | const userId = (req.query.userId as string) \|\| userService.getUserFromRequest(req)?.id;                      |
| server/src/domains/wallet/wallet.routes.ts:112                                                | 112  | routes     | const userId = req.body.userId \|\| userService.getUserFromRequest(req)?.id;                                   |
| server/src/domains/wallet/wallet.routes.ts:151                                                | 151  | routes     | const fromUserId = req.body.fromUserId \|\| userService.getUserFromRequest(req)?.id;                           |
| server/src/domains/wallet/wallet.routes.ts:190                                                | 190  | routes     | const userId = req.body.userId \|\| userService.getUserFromRequest(req)?.id;                                   |
| server/src/domains/wallet/wallet.routes.ts:228                                                | 228  | routes     | const userId = (req.query.userId as string) \|\| userService.getUserFromRequest(req)?.id;                      |
| server/src/domains/wallet/wallet.routes.ts:283                                                | 283  | routes     | const userId = (req.query.userId as string) \|\| userService.getUserFromRequest(req)?.id;                      |
| server/src/domains/wallet/wallet.controller.ts:39                                             | 39   | controller | const userId = this.getUserId(req);                                                                            |
| server/src/domains/wallet/wallet.controller.ts:109                                            | 109  | controller | const authUserId = (userService.getUserFromRequest(req) as any)?.id;                                           |
| server/src/domains/wallet/wallet.controller.ts:198                                            | 198  | controller | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/wallet/wallet.controller.ts:207                                            | 207  | controller | const userId = (userService.getUserFromRequest(req) as { id: number }).id; // Explicit cast after check        |
| server/src/domains/wallet/wallet.controller.ts:271                                            | 271  | controller | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/wallet/wallet.controller.ts:280                                            | 280  | controller | const userId = (userService.getUserFromRequest(req) as { id: number }).id; // Explicit cast after check        |
| server/src/domains/wallet/wallet.controller.ts:364                                            | 364  | controller | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/wallet/wallet.controller.ts:374                                            | 374  | controller | const userId = (userService.getUserFromRequest(req) as { id: number }).id; // Explicit cast after check        |
| server/src/domains/wallet/wallet.controller.ts:430                                            | 430  | controller | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/wallet/wallet.controller.ts:440                                            | 440  | controller | const userId = (userService.getUserFromRequest(req) as { id: number }).id; // Explicit cast after check        |
| server/src/domains/wallet/wallet.controller.ts:616                                            | 616  | controller | if (!userService.getUserFromRequest(req))                                                                      |
| server/src/domains/wallet/wallet.controller.ts:618                                            | 618  | controller | const userId = (userService.getUserFromRequest(req) as { id: number }).id;                                     |
| server/src/domains/wallet/wallet.dev.controller.ts:38                                         | 38   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/wallet.dev.controller.ts:59                                         | 59   | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/wallet/wallet.dev.controller.ts:74                                         | 74   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/wallet.dev.controller.ts:106                                        | 106  | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/wallet/wallet.dev.controller.ts:121                                        | 121  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/wallet.dev.controller.ts:138                                        | 138  | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/wallet/wallet.dev.controller.ts:201                                        | 201  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/wallet.dev.controller.ts:216                                        | 216  | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/wallet/wallet.test.controller.ts:24                                        | 24   | test       | (!userService.getUserFromRequest(req) \|\|                                                                     |
| server/src/domains/wallet/wallet.test.controller.ts:25                                        | 25   | test       | (userService.getUserFromRequest(req) as any).role !== 'admin')                                                 |
| server/src/domains/wallet/wallet.test.controller.ts:33                                        | 33   | test       | const targetUserId = userId \|\| (userService.getUserFromRequest(req) as any)?.id;                             |
| server/src/domains/wallet/wallet.test.controller.ts:42                                        | 42   | test       | requestingUser: (userService.getUserFromRequest(req) as any)?.id                                               |
| server/src/domains/wallet/wallet.test.controller.ts:198                                       | 198  | test       | const targetUserId = userId \|\| (userService.getUserFromRequest(req) as any)?.id;                             |
| server/src/domains/wallet/wallet.test.controller.ts:255                                       | 255  | test       | (!userService.getUserFromRequest(req) \|\|                                                                     |
| server/src/domains/wallet/wallet.test.controller.ts:256                                       | 256  | test       | ((userService.getUserFromRequest(req) as any).role !== 'admin' &&                                              |
| server/src/domains/wallet/wallet.test.controller.ts:257                                       | 257  | test       | (userService.getUserFromRequest(req) as any).id !== req.params.userId))                                        |
| server/src/domains/wallet/wallet.test.controller.ts:264                                       | 264  | test       | const targetUserId = req.params.userId \|\| (userService.getUserFromRequest(req) as any)?.id;                  |
| server/src/domains/wallet/withdrawal.controller.ts:40                                         | 40   | controller | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/wallet/withdrawal.controller.ts:44                                         | 44   | controller | const userId = (userService.getUserFromRequest(req) as { id: number }).id;                                     |
| server/src/domains/wallet/withdrawal.controller.ts:173                                        | 173  | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/wallet/withdrawal.controller.ts:184                                        | 184  | controller | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/wallet/withdrawal.controller.ts:188                                        | 188  | controller | const userId = (userService.getUserFromRequest(req) as { id: number }).id;                                     |
| server/src/domains/wallet/withdrawal.controller.ts:233                                        | 233  | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/wallet/withdrawal.controller.ts:308                                        | 308  | controller | const adminId = (userService.getUserFromRequest(req) as { id: number }).id;                                    |
| server/src/domains/wallet/wallet.test.routes.ts:18                                            | 18   | test       | if (!isDevMode() && userService.getUserFromRequest(req)?.role !== 'admin') {                                   |
| server/src/domains/xp/xp.controller.ts:127                                                    | 127  | controller | const authUserId = (userService.getUserFromRequest(req) as any)?.id; // Added type assertion                   |
| server/src/domains/xp/xp.controller.ts:131                                                    | 131  | controller | const isAdmin = (userService.getUserFromRequest(req) as any)?.role === 'admin'; // Added type assertion        |
| server/src/domains/auth/controllers/auth.controller.ts:193                                    | 193  | controller | const userResponse = { ...(userService.getUserFromRequest(req) as any) };                                      |
| server/src/domains/auth/middleware/auth.middleware.ts:11                                      | 11   | middleware | if (!userService.getUserFromRequest(req)) return false;                                                        |
| server/src/domains/auth/middleware/auth.middleware.ts:12                                      | 12   | middleware | return (userService.getUserFromRequest(req) as any).role === role;                                             |
| server/src/domains/auth/middleware/auth.middleware.ts:120                                     | 120  | middleware | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/auth/middleware/auth.middleware.ts:121                                     | 121  | middleware | userRole: (userService.getUserFromRequest(req) as any)?.role,                                                  |
| server/src/domains/auth/services/xAuthService.ts:76                                           | 76   | service    | if (userService.getUserFromRequest(req)) {                                                                     |
| server/src/domains/auth/services/xAuthService.ts:86                                           | 86   | service    | .where(eq(users.id, (userService.getUserFromRequest(req) as any).id));                                         |
| server/src/domains/auth/services/xAuthService.ts:132                                          | 132  | service    | if (!userService.getUserFromRequest(req))                                                                      |
| server/src/domains/auth/services/xAuthService.ts:143                                          | 143  | service    | .where(eq(users.id, (userService.getUserFromRequest(req) as any).id));                                         |
| server/src/domains/auth/services/auth.service.ts:183                                          | 183  | service    | export function getUserId(req: any): number {                                                                  |
| server/src/domains/auth/services/auth.service.ts:185                                          | 185  | service    | userService.getUserFromRequest(req)?.id \|\| userService.getUserFromRequest(req)?.user_id \|\| 0               |
| server/src/domains/admin/shared/admin-error-boundaries.ts:381                                 | 381  | other      | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/collectibles/stickers/stickers.controller.ts:88                            | 88   | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:113                           | 113  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:137                           | 137  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:161                           | 161  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:223                           | 223  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:248                           | 248  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:272                           | 272  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:315                           | 315  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/collectibles/stickers/stickers.controller.ts:361                           | 361  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:419                           | 419  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/collectibles/stickers/stickers.controller.ts:503                           | 503  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/engagement/airdrop/airdrop.controller.ts:24                                | 24   | controller | const adminUserId = userService.getUserFromRequest(req)?.id;                                                   |
| server/src/domains/engagement/airdrop/airdrop.controller.ts:25                                | 25   | controller | const isAdmin = userService.getUserFromRequest(req)?.role === 'admin';                                         |
| server/src/domains/engagement/airdrop/airdrop.controller.ts:94                                | 94   | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/engagement/airdrop/airdrop.controller.ts:95                                | 95   | controller | const isAdmin = userService.getUserFromRequest(req)?.role === 'admin';                                         |
| server/src/domains/engagement/airdrop/airdrop.controller.ts:140                               | 140  | controller | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/engagement/airdrop/airdrop.controller.ts:141                               | 141  | controller | const isAdmin = userService.getUserFromRequest(req)?.role === 'admin';                                         |
| server/src/domains/engagement/rain/rain.controller.ts:30                                      | 30   | controller | const fromUserId = userService.getUserFromRequest(req).id;                                                     |
| server/src/domains/engagement/rain/rain.controller.ts:93                                      | 93   | controller | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/engagement/vault/vault.controller.ts:26                                    | 26   | controller | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/engagement/vault/vault.controller.ts:88                                    | 88   | controller | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/engagement/vault/vault.controller.ts:148                                   | 148  | controller | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/engagement/vault/vault.controller.ts:180                                   | 180  | controller | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/engagement/vault/vault.controller.ts:181                                   | 181  | controller | const isAdmin = (userService.getUserFromRequest(req) as any)?.role === 'admin';                                |
| server/src/domains/forum/routes/bookmark.routes.ts:32                                         | 32   | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/bookmark.routes.ts:97                                         | 97   | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/bookmark.routes.ts:132                                        | 132  | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/content.routes.ts:61                                          | 61   | routes     | followingUserId: tab === 'following' ? userService.getUserFromRequest(req)?.id : undefined                     |
| server/src/domains/forum/routes/post.routes.ts:51                                             | 51   | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/post.routes.ts:99                                             | 99   | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/post.routes.ts:136                                            | 136  | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/post.routes.ts:162                                            | 162  | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/post.routes.ts:208                                            | 208  | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/thread.routes.ts:180                                          | 180  | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/thread.routes.ts:226                                          | 226  | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/routes/thread.routes.ts:272                                          | 272  | routes     | const userId = (userService.getUserFromRequest(req) as any)?.id;                                               |
| server/src/domains/forum/rules/rules.routes.ts:83                                             | 83   | routes     | (!userService.getUserFromRequest(req) \|\|                                                                     |
| server/src/domains/forum/rules/rules.routes.ts:84                                             | 84   | routes     | (userService.getUserFromRequest(req) as any).role !== 'admin')                                                 |
| server/src/domains/forum/rules/rules.routes.ts:102                                            | 102  | routes     | if (!req.isAuthenticated() \|\| !userService.getUserFromRequest(req)) {                                        |
| server/src/domains/forum/rules/rules.routes.ts:110                                            | 110  | routes     | // but as a safeguard if req.user exists but ID doesn't.                                                       |
| server/src/domains/forum/rules/rules.routes.ts:156                                            | 156  | routes     | if (!req.isAuthenticated() \|\| !userService.getUserFromRequest(req)) {                                        |
| server/src/domains/engagement/tip/tip.controller.ts:30                                        | 30   | controller | const fromUserId = userService.getUserFromRequest(req).id;                                                     |
| server/src/domains/engagement/tip/tip.controller.ts:59                                        | 59   | controller | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/engagement/tip/tip.controller.ts:105                                       | 105  | controller | const userId = userService.getUserFromRequest(req).id;                                                         |
| server/src/domains/forum/services/permissions.service.ts:234                                  | 234  | service    | \* @deprecated Use userService.getUserFromRequest() instead                                                    |
| server/src/domains/forum/services/permissions.service.ts:236                                  | 236  | service    | export function getUserFromRequest(req: any): User \| null {                                                   |
| server/src/domains/forum/services/permissions.service.ts:237                                  | 237  | service    | const user = userService.getUserFromRequest(req);                                                              |
| server/src/domains/forum/services/permissions.service.ts:258                                  | 258  | service    | const user = userService.getUserFromRequest(req);                                                              |
| server/src/domains/forum/services/permissions.service.ts:335                                  | 335  | service    | const user = userService.getUserFromRequest(req);                                                              |
| server/src/domains/forum/services/permissions.service.ts:361                                  | 361  | service    | const user = userService.getUserFromRequest(req);                                                              |
| server/src/domains/share/routes/xShareRoutes.ts:21                                            | 21   | routes     | userId: (userService.getUserFromRequest(req) as any).id,                                                       |
| server/src/domains/share/routes/xShareRoutes.ts:38                                            | 38   | routes     | userId: (userService.getUserFromRequest(req) as any).id,                                                       |
| server/src/domains/wallet/middleware/security.middleware.ts:64                                | 64   | middleware | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/middleware/security.middleware.ts:115                               | 115  | middleware | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/middleware/security.middleware.ts:166                               | 166  | middleware | const userId = userService.getUserFromRequest(req)?.id;                                                        |
| server/src/domains/wallet/middleware/security.middleware.ts:233                               | 233  | middleware | const fromUserId = userService.getUserFromRequest(req)?.id;                                                    |
| server/src/domains/wallet/middleware/security.middleware.ts:303                               | 303  | middleware | const adminUserId = userService.getUserFromRequest(req)?.id;                                                   |
| server/src/routes/api/user/frames.ts:9                                                        | 9    | routes     | if (!req.user) return res.status(401).json({ error: 'Not authenticated' });                                    |
| server/src/routes/api/user/frames.ts:10                                                       | 10   | routes     | const userId = (req.user as any).id as string;                                                                 |
| server/src/domains/admin/sub-domains/analytics/system-analytics.controller.ts:230             | 230  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/airdrop/airdrop.controller.ts:20                         | 20   | controller | const adminId = userService.getUserFromRequest(req)?.id; // Assuming adminId is available from auth middleware |
| server/src/routes/api/store/avatar-frames.ts:26                                               | 26   | routes     | if (!req.user) return res.status(401).json({ error: 'Not authenticated' });                                    |
| server/src/routes/api/store/avatar-frames.ts:27                                               | 27   | routes     | const userId = (req.user as any).id as string;                                                                 |
| server/src/domains/admin/sub-domains/cache/cache.controller.ts:32                             | 32   | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/cache/cache.controller.ts:74                             | 74   | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/cache/cache.controller.ts:131                            | 131  | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/cache/cache.controller.ts:171                            | 171  | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/avatar-frames/avatar-frames.controller.ts:67             | 67   | controller | createdBy: userService.getUserFromRequest(req)?.id                                                             |
| server/src/domains/admin/sub-domains/avatar-frames/avatar-frames.controller.ts:81             | 81   | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/admin/sub-domains/avatar-frames/avatar-frames.controller.ts:106            | 106  | controller | updatedBy: userService.getUserFromRequest(req)?.id                                                             |
| server/src/domains/admin/sub-domains/avatar-frames/avatar-frames.controller.ts:121            | 121  | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/admin/sub-domains/avatar-frames/avatar-frames.controller.ts:144            | 144  | controller | deletedBy: userService.getUserFromRequest(req)?.id                                                             |
| server/src/domains/admin/sub-domains/avatar-frames/avatar-frames.controller.ts:152            | 152  | controller | userId: userService.getUserFromRequest(req)?.id                                                                |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:89           | 89   | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:113          | 113  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:269          | 269  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:293          | 293  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:373          | 373  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:398          | 398  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:422          | 422  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/backup-restore/backup-restore.controller.ts:446          | 446  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/database/database.controller.ts:58                       | 58   | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:87                       | 87   | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:127                      | 127  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:170                      | 170  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:237                      | 237  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:299                      | 299  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:354                      | 354  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:421                      | 421  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:460                      | 460  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/database.controller.ts:500                      | 500  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/bulk-operations.controller.ts:52                | 52   | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/bulk-operations.controller.ts:225               | 225  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/bulk-operations.controller.ts:299               | 299  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/query.controller.ts:33                          | 33   | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/query.controller.ts:102                         | 102  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/query.controller.ts:138                         | 138  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/query.controller.ts:175                         | 175  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/query.controller.ts:215                         | 215  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/query.controller.ts:244                         | 244  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/database/query.controller.ts:289                         | 289  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/emojis/emojis.controller.ts:21                           | 21   | controller | function getUserId(req: Request): number \| undefined {                                                        |
| server/src/domains/admin/sub-domains/emojis/emojis.controller.ts:22                           | 22   | controller | return (userService.getUserFromRequest(req) as any)?.id;                                                       |
| server/src/domains/admin/sub-domains/emojis/emojis.controller.ts:131                          | 131  | controller | createdBy: userService.getUserFromRequest(req)                                                                 |
| server/src/domains/admin/sub-domains/email-templates/email-templates.controller.ts:113        | 113  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/email-templates/email-templates.controller.ts:139        | 139  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/email-templates/email-templates.controller.ts:172        | 172  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/email-templates/email-templates.controller.ts:247        | 247  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/forum/forum.controller.ts:244                            | 244  | controller | userService.getUserFromRequest(req),                                                                           |
| server/src/domains/admin/sub-domains/moderator-notes/moderator-notes.routes.ts:124            | 124  | routes     | const isAdmin = userService.getUserFromRequest(req)?.role === 'admin';                                         |
| server/src/domains/admin/sub-domains/permissions/permissions.routes.ts:12                     | 12   | routes     | const user = userService.getUserFromRequest(req);                                                              |
| server/src/domains/admin/sub-domains/referrals/referrals.controller.ts:15                     | 15   | controller | const createdBy = userService.getUserFromRequest(req)?.id;                                                     |
| server/src/domains/admin/sub-domains/reports/reports.controller.ts:62                         | 62   | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/reports/reports.controller.ts:92                         | 92   | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/reports/reports.controller.ts:122                        | 122  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/reports/reports.controller.ts:160                        | 160  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/roles/roles.routes.ts:12                                 | 12   | routes     | const user = userService.getUserFromRequest(req);                                                              |
| server/src/domains/admin/sub-domains/subscriptions/subscription.admin.controller.ts:270       | 270  | controller | const adminUserId = userService.getUserFromRequest(req)?.id;                                                   |
| server/src/domains/admin/sub-domains/subscriptions/subscription.admin.controller.ts:334       | 334  | controller | const adminUserId = userService.getUserFromRequest(req)?.id;                                                   |
| server/src/domains/admin/sub-domains/titles/titles.routes.ts:12                               | 12   | routes     | const user = userService.getUserFromRequest(req);                                                              |
| server/src/domains/admin/sub-domains/ui-config/ui-config.controller.ts:94                     | 94   | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/ui-config/ui-config.controller.ts:124                    | 124  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/ui-config/ui-config.controller.ts:225                    | 225  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/ui-config/ui-config.controller.ts:261                    | 261  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/ui-config/ui-config.controller.ts:405                    | 405  | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/treasury/treasury.controller.ts:42                       | 42   | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/treasury/treasury.controller.ts:65                       | 65   | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/treasury/treasury.controller.ts:88                       | 88   | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/treasury/treasury.controller.ts:127                      | 127  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/users/bulk-operations.controller.ts:37                   | 37   | controller | const adminId = (userService.getUserFromRequest(req) as any)?.id;                                              |
| server/src/domains/admin/sub-domains/users/bulk-operations.controller.ts:87                   | 87   | controller | const adminId = (userService.getUserFromRequest(req) as any)?.id;                                              |
| server/src/domains/admin/sub-domains/users/bulk-operations.controller.ts:137                  | 137  | controller | const adminId = (userService.getUserFromRequest(req) as any)?.id;                                              |
| server/src/domains/admin/sub-domains/users/bulk-operations.controller.ts:183                  | 183  | controller | const adminId = (userService.getUserFromRequest(req) as any)?.id;                                              |
| server/src/domains/admin/sub-domains/users/users.controller.ts:99                             | 99   | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/users/users.controller.ts:140                            | 140  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/users/users.controller.ts:182                            | 182  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/users/users.controller.ts:223                            | 223  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/users/users.controller.ts:264                            | 264  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/users/users.controller.ts:312                            | 312  | controller | const adminId = userService.getUserFromRequest(req);                                                           |
| server/src/domains/admin/sub-domains/xp/xp.controller.ts:249                                  | 249  | controller | const adminId = userService.getUserFromRequest(req)?.id;                                                       |
| server/src/domains/admin/sub-domains/xp/xp.controller.ts:353                                  | 353  | controller | adminId: userService.getUserFromRequest(req)?.id,                                                              |
| server/src/domains/admin/sub-domains/wallet/wallet.controller.ts:80                           | 80   | controller | const adminUserId = userService.getUserFromRequest(req)?.id;                                                   |
| server/src/domains/admin/sub-domains/wallet/wallet.controller.ts:116                          | 116  | controller | const adminUserId = userService.getUserFromRequest(req)?.id;                                                   |
| server/src/domains/admin/sub-domains/roles/roles.controller.ts:23                             | 23   | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/roles/roles.controller.ts:52                             | 52   | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/roles/roles.controller.ts:85                             | 85   | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/roles/roles.controller.ts:115                            | 115  | controller | userId: (userService.getUserFromRequest(req) as any)?.id,                                                      |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:15 | 15   | controller | \* Helper function to get user ID from req.user, handling both id and user_id formats                          |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:17 | 17   | controller | function getUserId(req: Request): number {                                                                     |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:19 | 19   | controller | (userService.getUserFromRequest(req) as any)?.id \|\|                                                          |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:20 | 20   | controller | (userService.getUserFromRequest(req) as any)?.user_id \|\|                                                     |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:31 | 31   | controller | const userRole = userService.getUserFromRequest(req)?.role \|\| 'guest';                                       |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:32 | 32   | controller | const userId = userService.getUserFromRequest(req);                                                            |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:89 | 89   | controller | if (!userService.getUserFromRequest(req)) {                                                                    |
| server/src/domains/admin/sub-domains/announcements/controllers/announcements.controller.ts:96 | 96   | controller | createdBy: userService.getUserFromRequest(req)                                                                 |
| server/src/domains/admin/sub-domains/social/social.controller.ts:28                           | 28   | controller | const adminUserId = userService.getUserFromRequest(req)!.id;                                                   |
| server/src/domains/admin/sub-domains/social/social.controller.ts:67                           | 67   | controller | const adminUserId = userService.getUserFromRequest(req)!.id;                                                   |
| server/src/domains/admin/sub-domains/social/social.controller.ts:105                          | 105  | controller | const adminUserId = userService.getUserFromRequest(req)!.id;                                                   |
